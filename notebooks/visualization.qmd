```{python}
import pandas as pd
import sys
from great_tables import GT
from pyprojroot.here import here
```

```{python}
sys.path.append("..")
```

# Table1: Summary of YOLOv11 Classification Model Performance

```{python}
table_base = pd.read_csv(here("output/f1_score/summary_yolo_batch8_imgsz256_base.csv"))
table_cv = pd.read_csv(here("output/f1_score/summary_yolo_batch8_imgsz256.csv"))
```

```{python}
table1 = pd.concat([table_base, table_cv], ignore_index=True)
table1
gt = GT(table1)
gt.show()
```

# Table2: Local Moran's I Analysis

```{python}
from src.visualisation.table2_local_moran import *
```

```{python}
df_results_5 = gpd.read_file(here("output/density/waste_moran_5_points.gpkg"))
df_results_5
df_prop_5 = df_results_5.groupby(["quadrant", "significant"]).size()

quadrant_summary_5 = generate_table_quadrant_summary(df_results_5)
```

```{python}
quadrant_summary_5
```

# Table3: Waterway Analysis
```{python}
from src.visualisation.table3_waterway import *
```
```{python}
# Read data
df = read_waste_data()
df_buffer = read_buffer_waterway()

# Merge waste hot spots with waterway buffer
df_waste_waterway = merge_waste_waterway(df, df_buffer)
hot_spots_near_waterway = df_waste_waterway[df_waste_waterway['waterway'] == True]


df_summary_waterway = pd.DataFrame({
    "Total_Hot_Spots": len(df),
    "Hot_Spots_Near_Waterway": [len(hot_spots_near_waterway)],
    "Proportion_Near_Waterway": [len(hot_spots_near_waterway) / len(df) if len(df) > 0 else 0]
})

df_summary_waterway
```

# Figure1

The calculation takes a very long time, so it is commented out. Please run it as needed.
The results are shown in the table below.
```{python}
# read data
df_waste_5 = read_data(grid_size=5)
# Create spatial weights matrix
w_5 = calculate_weights(df_waste_5)
# Calculate global Moran's I
mi_5 = calculate_global_moran(df_waste_5, w_5)

df_5 = summary_moran(mi_5, label="5m")

p = plot_morans_I(df_5)
```

5m’s grid(raw grid)
Moran’s I: 0.26788
Expected I: -0.00000
Z-score: 997.613
P-value (permutation): 0.001000
